// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
  
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
  SUPER_ADMIN
  STAFF
}

enum Status {
  ACTIVE
  INACTIVE
  PENDING
  DELETED
}

enum SchoolType {
  HIGH
  MIDDLE
}

model User {
  id    String     @id @default(uuid())
  authId String @unique
  email String  @unique
  provider String
  username String?
  role Role @default(USER)
  isEmailVerified Boolean @default(false)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  status Status @default(ACTIVE)

}



model Region {
  id        String   @id @default(uuid())
  name      String @unique
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  schools School[]
}

model Director {
  id     String @id @default(uuid())
  name   String
  email  String?
  phone  String?

  school   School @relation(fields: [schoolId], references: [id],onDelete: Cascade)
  schoolId String  @unique
}


model School {
  id        String     @id @default(uuid())
  name      String     
  type      SchoolType

  regionId  String?
  region    Region?    @relation(fields: [regionId], references: [id],onDelete: Restrict)

  staffCount Int?

  director   Director? 

  highSchool    HighSchool?
  secondarySchool MiddleSchool?

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@unique([name, type])

}
model MiddleSchool {
  schoolId String  @id
  school   School  @relation(fields: [schoolId], references: [id],onDelete: Cascade)


  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt 
}

model HighSchool {
  schoolId String @id
  school   School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  classStatistics ClassStatistic[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


enum CurriculumComponentKind {
  MAJOR
  ELECTIVE
}

model CurriculumComponent {
  id        String @id @default(uuid())
  name      String
  kind      CurriculumComponentKind

  classStatistics ClassStatistic[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
  @@unique([name, kind])

}




model ClassStatistic {
  id           String @id @default(uuid())

  maleStudents   Int
  femaleStudents Int

  componentId  String
  component CurriculumComponent @relation(fields: [componentId], references: [id], onDelete: Cascade)
  
  schoolId     String
  school    HighSchool     @relation(fields: [schoolId], references: [schoolId], onDelete: Cascade)

  @@unique([schoolId, componentId])
}
